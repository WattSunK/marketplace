<div class="container-fluid px-4">
  <h2 class="mt-4">Items</h2>

  <!-- Top controls -->
  <div class="mb-3 d-flex align-items-center flex-wrap gap-2">
    <button id="btn-add-item" class="btn btn-outline-warning btn-sm">+ Add Item</button>
    <button id="btn-manage-categories" class="btn btn-outline-warning btn-sm">Manage Categories</button>

    <select id="category-filter" class="form-select form-select-sm w-auto ms-auto">
      <option value="">All Categories</option>
    </select>
    <input type="text" id="search-text" class="form-control form-control-sm w-auto" placeholder="Search by name or SKU">
    <button id="search-button" class="btn btn-outline-warning btn-sm">Search</button>
    <button id="clear-button" class="btn btn-outline-warning btn-sm">Clear</button>
  </div>

  <!-- Show entries selector -->
  <div class="d-flex justify-content-start mb-2 align-items-center gap-2">
    <label for="items-per-page" class="form-label mb-0">Show</label>
    <select id="items-per-page" class="form-select form-select-sm w-auto">
      <option value="15" selected>15</option>
      <option value="25">25</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select>
    <span>entries</span>
  </div>

  <!-- Items Table -->
  <div class="table-responsive">
    <table id="items-table" class="table table-bordered table-striped align-middle">
      <thead class="table-warning">
        <tr>
          <th>SL. NO</th>
          <th>IMAGE</th>
          <th>ITEM NAME</th>
          <th>SKU</th>
          <th>CATEGORY</th>
          <th>STOCK</th>
          <th>UNIT PRICE</th>
          <th>STATUS</th>
          <th>ACTION</th>
        </tr>
      </thead>
      <tbody id="items-table-body"><!-- filled by admin-items.js --></tbody>
    </table>
  </div>

  <!-- Pagination info & controls -->
  <div class="d-flex justify-content-between align-items-center mt-2">
    <div id="items-table-info" class="small text-muted">Showing 0 to 0 of 0 entries</div>
    <div class="pagination" id="items-pagination"></div>
  </div>
</div>

<!-- Inline script kept for fallback only; guarded to avoid clashing with admin-items.js -->
<script>
/* If admin-items.js is present, skip this fallback script. */
if (window.adminItems || window.initAdminItems) {
  // dashboard JS will manage the table; do nothing here
} else {
  document.addEventListener("DOMContentLoaded", function() {
    const tableBody = document.getElementById("items-table-body");
    const pagination = document.getElementById("items-pagination");
    const info = document.getElementById("items-table-info");
    const perPageSelect = document.getElementById("items-per-page");
    const searchInput = document.getElementById("search-text");
    const categoryFilter = document.getElementById("category-filter");

    let allRows = [];
    let filteredRows = [];
    let currentPage = 1;
    let perPage = parseInt(perPageSelect.value);

    function initRows() {
      allRows = Array.from(tableBody.querySelectorAll("tr"));
      applyFilters();
    }

    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedCategory = categoryFilter.value;

      filteredRows = allRows.filter(row => {
        const cells = row.querySelectorAll("td");
        const name = cells[2]?.textContent.toLowerCase() || "";
        const sku = cells[3]?.textContent.toLowerCase() || "";
        const category = cells[4]?.textContent || "";
        const matchesSearch = !searchTerm || name.includes(searchTerm) || sku.includes(searchTerm);
        const matchesCategory = !selectedCategory || category === selectedCategory;
        return matchesSearch && matchesCategory;
      });

      currentPage = 1;
      renderTable();
    }

    function renderTable() {
      tableBody.innerHTML = "";
      const start = (currentPage - 1) * perPage;
      const end = start + perPage;
      const pageRows = filteredRows.slice(start, end);
      pageRows.forEach(row => tableBody.appendChild(row));

      const total = filteredRows.length;
      const showingStart = total === 0 ? 0 : start + 1;
      const showingEnd = Math.min(end, total);
      info.textContent = `Showing ${showingStart} to ${showingEnd} of ${total} entries`;

      renderPagination(total);
    }

    function renderPagination(total) {
      pagination.innerHTML = "";
      const totalPages = Math.ceil(total / perPage);
      if (totalPages <= 1) return;

      const createButton = (label, disabled, onClick) => {
        const btn = document.createElement("button");
        btn.textContent = label;
        btn.className = "btn btn-outline-warning btn-sm mx-1";
        btn.disabled = disabled;
        btn.addEventListener("click", onClick);
        pagination.appendChild(btn);
      };

      createButton("First", currentPage === 1, () => { currentPage = 1; renderTable(); });
      createButton("Prev", currentPage === 1, () => { currentPage--; renderTable(); });

      const pageWindow = 2;
      const startPage = Math.max(1, currentPage - pageWindow);
      const endPage = Math.min(totalPages, currentPage + pageWindow);

      for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `btn ${i === currentPage ? "btn-warning" : "btn-outline-warning"} btn-sm mx-1`;
        btn.addEventListener("click", () => { currentPage = i; renderTable(); });
        pagination.appendChild(btn);
      }

      createButton("Next", currentPage === totalPages, () => { currentPage++; renderTable(); });
      createButton("Last", currentPage === totalPages, () => { currentPage = totalPages; renderTable(); });
    }

    perPageSelect.addEventListener("change", () => {
      perPage = parseInt(perPageSelect.value);
      currentPage = 1;
      renderTable();
    });

    document.getElementById("search-button").addEventListener("click", applyFilters);
    document.getElementById("clear-button").addEventListener("click", () => {
      searchInput.value = "";
      categoryFilter.value = "";
      applyFilters();
    });
    categoryFilter.addEventListener("change", applyFilters);

    setTimeout(initRows, 500); // delay to allow rows to exist when used standalone
  });
}
</script>
