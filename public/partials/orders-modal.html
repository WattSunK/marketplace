<!-- Orders Modals (normalized) -->

<!-- =========================
     View Order (read-only)
     ========================= -->
<dialog id="orderViewModal" class="modal" aria-labelledby="ov_title" aria-modal="true">
  <div class="modal-card">
    <header class="modal-header">
      <h3 id="ov_title">Order</h3>
      <button type="button" data-ov-close class="btn ghost small">Close</button>
    </header>

    <section class="modal-body">
      <div class="grid rows">
        <div class="row">
          <label>Order #</label>
          <div><span id="ov_order">—</span></div>
        </div>

        <div class="row">
          <label>Status</label>
          <div><span id="ov_status">—</span></div>
        </div>

        <div class="row">
          <label>Customer</label>
          <div><span id="ov_customer">—</span></div>
        </div>

        <div class="row">
          <label>Phone</label>
          <div><span id="ov_phone">—</span></div>
        </div>

        <div class="row">
          <label>Email</label>
          <div><span id="ov_email">—</span></div>
        </div>

        <div class="row">
          <label>Placed</label>
          <div><span id="ov_placed">—</span></div>
        </div>

        <div class="row">
          <label>Total</label>
          <div><span id="ov_total">—</span></div>
        </div>

        <div class="row">
          <label>Driver</label>
          <div><span id="ov_driver">—</span></div>
        </div>
      </div>

      <h4 class="section-title">Items</h4>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>SKU</th>
              <th>Name</th>
              <th>Qty</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody id="ov_itemsBody">
            <tr><td colspan="4">No items</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer class="modal-footer">
      <button type="button" class="btn" data-ov-close>Close</button>
    </footer>
  </div>
</dialog>


<!-- =========================
     Edit Order
     ========================= -->
<dialog id="orderEditModal" class="modal" aria-labelledby="oem_title" aria-modal="true">
  <div class="modal-card">
    <header class="modal-header">
      <h3 id="oem_title">Edit Order</h3>
      <button type="button" class="btn ghost small" id="oemCancelX">Close</button>
    </header>

    <form id="orderEditForm" class="modal-body" method="dialog">
      <div class="grid rows">
        <!-- Status -->
        <div class="row">
          <label for="orderStatus">Status</label>
          <div>
            <select id="orderStatus" name="status" class="input">
              <option>Pending</option>
              <option>Confirmed</option>
              <option>Dispatched</option>
              <option>Delivered</option>
              <option>Cancelled</option>
            </select>
          </div>
        </div>

        <!-- Driver -->
        <div class="row">
          <label for="orderDriver">Driver</label>
          <div>
            <select id="orderDriver" name="driverId" class="input">
              <!-- populated by JS -->
            </select>
          </div>
        </div>

        <!-- Totals -->
        <div class="row">
          <label for="orderTotal">Total (cents)</label>
          <div><input id="orderTotal" name="totalCents" type="number" class="input" inputmode="numeric" min="0" /></div>
        </div>

        <div class="row">
          <label for="orderDeposit">Deposit (cents)</label>
          <div><input id="orderDeposit" name="depositCents" type="number" class="input" inputmode="numeric" min="0" /></div>
        </div>

        <div class="row">
          <label for="orderCurrency">Currency</label>
          <div>
            <input id="orderCurrency" name="currency" type="text" class="input" maxlength="3" placeholder="KES" />
          </div>
        </div>

        <!-- Notes -->
        <div class="row">
          <label for="orderNotes">Notes</label>
          <div>
            <textarea id="orderNotes" name="notes" rows="4" class="input" placeholder="Internal note (optional)"></textarea>
          </div>
        </div>
      </div>
    </form>

    <footer class="modal-footer">
      <button type="button" class="btn ghost" id="oemCancel">Cancel</button>
      <button type="button" class="btn primary" id="oemSave">Save</button>
    </footer>
  </div>
</dialog>

<script>
  // lightweight close wiring for the view dialog's [data-ov-close]
  (function () {
    const v = document.getElementById('orderViewModal');
    if (!v) return;
    v.addEventListener('click', (e) => {
      if (e.target && (e.target.hasAttribute('data-ov-close') || e.target === v)) {
        try { v.close(); } catch { v.removeAttribute('open'); }
      }
    });

    // Edit dialog close buttons
    const eDlg = document.getElementById('orderEditModal');
    const cancelers = ['oemCancel', 'oemCancelX'];
    cancelers.forEach(id => {
      const el = document.getElementById(id);
      if (el && eDlg) {
        el.addEventListener('click', () => { try { eDlg.close(); } catch { eDlg.removeAttribute('open'); } });
      }
    });
  })();
</script>
