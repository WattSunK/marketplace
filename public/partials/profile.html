<!-- Profile with Hybrid Tabs -->
<nav class="subtabs" role="tablist" aria-label="Account sections">
  <button class="subtab is-active" role="tab" aria-selected="true" data-tab="profile">Profile</button>
  <button class="subtab" role="tab" aria-selected="false" data-route="/partials/myorders.html">Orders</button>
  <button class="subtab" role="tab" aria-selected="false" data-tab="addresses">Delivery Addresses</button>
  <button class="subtab" role="tab" aria-selected="false" data-tab="payments">Payment Methods</button>
  <button class="subtab" role="tab" aria-selected="false" data-tab="emails">Email Settings</button>
</nav>

<div class="tabpanels">
  <!-- PROFILE (local) -->
  <section class="tabpanel" role="tabpanel" data-tabpanel="profile">
    <section class="card">
      <div class="card-header">My Account</div>
      <div class="card-body">
        <div class="form-group">
          <label for="profName"><strong>Name</strong></label>
          <input id="profName" class="input" type="text" placeholder="Your name">
        </div>
        <div class="form-group">
          <label for="profEmail"><strong>Email</strong></label>
          <input id="profEmail" class="input" type="email" placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label for="profPhone"><strong>Phone</strong></label>
          <input id="profPhone" class="input" type="tel" placeholder="+254...">
        </div>
        <div class="actions">
          <button id="btnSaveProfile" class="btn btn-primary" type="button">Save Changes</button>
          <button class="btn" type="button">Cancel</button>
          <a class="btn btn-ghost" href="#" onclick="toast('Password flow TBD','info');return false;">Change Password &gt;</a>
        </div>
      </div>
    </section>
  </section>

  <!-- ADDRESSES (local) -->
  <section class="tabpanel" role="tabpanel" data-tabpanel="addresses" hidden>
    <section class="card">
      <div class="card-header">Delivery Addresses</div>
      <div class="card-body">
        <div class="empty">
          <div class="title">No addresses yet</div>
          <div>Add a delivery address to get started.</div>
        </div>
      </div>
    </section>
  </section>

  <!-- PAYMENTS (local) -->
  <section class="tabpanel" role="tabpanel" data-tabpanel="payments" hidden>
    <section class="card">
      <div class="card-header">Payment Methods</div>
      <div class="card-body">
        <div class="empty">
          <div class="title">No payment methods</div>
          <div>Add a card or mobile money method to save time at checkout.</div>
        </div>
      </div>
    </section>
  </section>

  <!-- EMAIL SETTINGS (local) -->
  <section class="tabpanel" role="tabpanel" data-tabpanel="emails" hidden>
    <section class="card">
      <div class="card-header">Email Settings</div>
      <div class="card-body">
        <div class="empty">
          <div class="title">Preferences</div>
          <div>Pick the notifications you want to receive.</div>
        </div>
      </div>
    </section>
  </section>
</div>

<script>
  (function(){
    const tabs   = [...document.querySelectorAll('.subtab')];
    const panels = [...document.querySelectorAll('.tabpanel')];

    function goToPartial(url){
      const match = [...document.querySelectorAll('.admin-nav .nav-link')]
        .find(a => a.getAttribute('data-url') === url);
      if (match) { match.click(); return; }
      window.dispatchEvent(new CustomEvent('admin:navigate', { detail: { url } }));
    }

    function activateLocal(name){
      tabs.forEach(t => {
        const on = t.dataset.tab === name;
        t.classList.toggle('is-active', on);
        t.setAttribute('aria-selected', on ? 'true' : 'false');
      });
      panels.forEach(p => p.hidden = (p.dataset.tabpanel !== name));
      const u = new URL(location.href); u.searchParams.set('tab', name); history.replaceState({}, '', u);
    }

    tabs.forEach(btn => {
      const route = btn.dataset.route;
      const local = btn.dataset.tab;
      btn.addEventListener('click', () => {
        if (route) goToPartial(route);
        else if (local) activateLocal(local);
      });
    });

    const initial = new URL(location.href).searchParams.get('tab') || 'profile';
    activateLocal(initial);

    const save = document.getElementById('btnSaveProfile');
    if (save) {
      save.addEventListener('click', async () => {
        save.classList.add('is-loading'); save.disabled = true;
        try {
          await new Promise(r => setTimeout(r, 600));
          toast('Profile saved', 'success'); window.markFormClean?.();
        } catch (e) {
          toast('Could not save profile', 'error');
        } finally {
          save.classList.remove('is-loading'); save.disabled = false;
        }
      });
    }
  })();
</script>
