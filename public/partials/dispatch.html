<!-- /public/partials/settings.html -->
<section class="ws-admin-section">
  <h2 class="ws-admin-title">Settings</h2>

  <!-- Small read-only summary -->
  <div class="settings-summary-card" style="border-left:4px solid #3b82f6;background:#f0f7ff;padding:12px 14px;margin:10px 0 18px;border-radius:8px;">
    <div style="display:flex;flex-wrap:wrap;gap:18px;align-items:center;">
      <div><strong>Currency:</strong> <span id="ro-currency">—</span></div>
      <div><strong>Deposit %:</strong> <span id="ro-deposit">—</span></div>
      <div><strong>Contact Email:</strong> <span id="ro-email">—</span></div>
      <div style="margin-left:auto;color:#6b7280;font-size:12px;">view-only panel (wired later)</div>
    </div>
  </div>

  <!-- Local grid to arrange cards in 3 columns -->
  <style>
    .settings-grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(260px, 1fr));
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 1100px) {
      .settings-grid-3 { grid-template-columns: repeat(2, minmax(260px, 1fr)); }
    }
    @media (max-width: 720px) {
      .settings-grid-3 { grid-template-columns: 1fr; }
    }
    /* Fallback in case .settings-card has minimal styling in admin.css */
    .settings-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 14px;
    }
    .settings-card h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      font-weight: 600;
    }
    .settings-input { width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 8px; }
    .settings-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .settings-btn { padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; cursor: pointer; }
    .danger { border-color: #fecaca; background: #fff7f7; }
    .danger-btn { padding: 8px 12px; border: 1px solid #ef4444; color: #ef4444; border-radius: 8px; background: #fff; cursor: pointer; }
  </style>

  <div class="settings-grid-3">
    <!-- Company Information -->
    <div class="settings-card">
      <h3>Company Information</h3>

      <label>Company Name
        <input type="text" class="settings-input" id="set-company-name" value="WattSun Solar">
      </label>

      <label>Support Email
        <input type="email" class="settings-input" id="set-support-email" value="support@wattsun.co.ke">
      </label>

      <label>Support Phone
        <input type="text" class="settings-input" id="set-support-phone" value="+254700123456">
      </label>

      <label>Physical Address
        <input type="text" class="settings-input" id="set-support-address" value="Nairobi, Kenya">
      </label>
    </div>

    <!-- User Management -->
    <div class="settings-card">
      <h3>User Management</h3>

      <label style="display:flex;align-items:center;gap:10px;">
        <input type="checkbox" id="set-strong-pw" checked>
        Enforce strong passwords
      </label>

      <label>Session Timeout
        <select id="set-timeout" class="settings-input">
          <option>15 minutes</option>
          <option>30 minutes</option>
          <option selected>1 hour</option>
          <option>2 hours</option>
          <option>4 hours</option>
        </select>
      </label>

      <label style="display:flex;align-items:center;gap:10px;">
        <input type="checkbox" id="set-allow-reset" checked>
        Allow Password Reset
      </label>
    </div>

    <!-- Notifications -->
    <div class="settings-card">
      <h3>Notifications</h3>

      <label style="display:flex;align-items:center;gap:10px;">
        <input type="checkbox" id="set-order-placed" checked>
        Order Placed Email
      </label>

      <label style="display:flex;align-items:center;gap:10px;">
        <input type="checkbox" id="set-order-delivered" checked>
        Order Delivered Email
      </label>

      <div style="display:flex;align-items:center;gap:10px;margin-top:10px;">
        <label style="margin:0;display:flex;align-items:center;gap:10px;">
          <input type="checkbox" id="set-low-stock" checked>
          Low Stock Alerts
        </label>
        <input type="number" min="1" id="set-low-stock-threshold" class="settings-input" style="width:80px;" value="10">
        <span>threshold</span>
      </div>

      <label style="margin-top:10px;">Send notifications to
        <input type="email" class="settings-input" id="set-alerts-email" value="alerts@wattsun.co.ke">
      </label>
    </div>

    <!-- Integrations -->
    <div class="settings-card">
      <h3>Integrations</h3>

      <label>Paybill Number
        <input type="text" class="settings-input" id="set-paybill" value="123456">
      </label>

      <label>API Key
        <input type="password" class="settings-input" id="set-api-key" value="••••••••••">
      </label>

      <label>SMS Gateway
        <select id="set-sms-gateway" class="settings-input">
          <option>Twilio</option>
          <option selected>Africa's Talking</option>
          <option>Infobip</option>
        </select>
      </label>

      <label>Sender ID
        <input type="text" class="settings-input" id="set-sender-id" value="WattSun">
      </label>

      <label>SMS API Key
        <input type="password" class="settings-input" id="set-sms-api-key" value="••••••••••">
      </label>
    </div>

    <!-- Appearance -->
    <div class="settings-card">
      <h3>Appearance</h3>

      <label>Logo Upload
        <input type="file" id="set-logo-file">
      </label>

      <label>Theme
        <select id="set-theme" class="settings-input">
          <option selected>Light</option>
          <option>Dark</option>
          <option>System</option>
        </select>
      </label>
    </div>

    <!-- System Controls -->
    <div class="settings-card">
      <h3>System Controls</h3>

      <div class="settings-actions">
        <button class="settings-btn" id="btn-backup">Backup Data</button>
      </div>

      <label>Restore from Backup
        <input type="file" id="set-restore-file">
      </label>

      <div class="settings-actions">
        <button class="settings-btn" id="btn-export">Export Data</button>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="settings-card danger">
      <h3>Danger Zone</h3>
      <div class="settings-actions">
        <button class="danger-btn" id="btn-delete-test">Delete All Test Data</button>
        <button class="danger-btn" id="btn-factory-reset">Factory Reset</button>
      </div>
    </div>
  </div>
</section>

<script>
(() => {
  const roCurrency = document.getElementById('ro-currency');
  const roDeposit  = document.getElementById('ro-deposit');
  const roEmail    = document.getElementById('ro-email');

  async function loadSettings() {
    // safe defaults for v0.1
    let data = { currency: 'KES', deposit_percent: 20, contact_email: 'support@wattsun.co.ke' };
    try {
      const res = await fetch('/api/admin/settings?_=' + Date.now());
      if (res.ok) {
        const j = await res.json();
        data = {
          currency: j.currency ?? data.currency,
          deposit_percent: j.deposit_percent ?? j.depositPercent ?? data.deposit_percent,
          contact_email: j.contact_email ?? j.contactEmail ?? data.contact_email
        };
      }
    } catch (e) {
      // keep defaults silently
    }
    roCurrency.textContent = data.currency || '—';
    roDeposit.textContent  = (data.deposit_percent != null) ? `${data.deposit_percent}%` : '—';
    roEmail.textContent    = data.contact_email || '—';
  }

  loadSettings();
})();
</script>
