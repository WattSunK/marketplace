<!DOCTYPE html>
<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta charset="utf-8"/>
<title>Shop - WattSun</title>
<link href="main.css" rel="stylesheet"/>
<style>
    html, body { height: 100%; min-height: 100%; box-sizing: border-box; }
    body { display: flex; flex-direction: column; min-height: 100vh; background: #fffdf7; }
    header {
  order: 0; flex-shrink: 0; }
    .container { max-width: 1200px; margin: 28px auto 0 auto; padding: 0 1em; }
    .nav-inner { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .nav-left img { height: 56px; width: auto; display: block; }
    header nav {
      background: #ffffff; border: 1px solid #f3e5b2; border-radius: 16px; padding: 8px; display: flex; align-items: center; gap: 0; margin-bottom: 12px; justify-content: space-between; }
    header nav .nav-main { display: flex; flex-wrap: wrap; gap: 4px; }
    header nav a {
      color: #191813; text-decoration: none; padding: 7px 12px; border-radius: 10px; border: 1px solid transparent;
      font-size: 14px; letter-spacing: 0.02em; display: inline-flex; align-items: center; gap: 6px;
    }
    header nav a:hover { background: #fff7e0; border-color: #fce9a3; }
    header nav .nav-right { display: flex; align-items: center; gap: 6px; }
    .nav-toggle { display:none; }
    @media (max-width: 820px) {
      .nav-toggle { display: block; background: #fff7e0; border: 1px solid #fce9a3; border-radius: 10px; padding: 7px 12px; }
      header nav .nav-main { display: none; width:100%; margin-top: 8px; }
      header.nav-open nav .nav-main { display: flex; }
      header nav { flex-direction: column; align-items: stretch; }
    }
    .hero {
      background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%);
      color: #1a1500; padding: 18px 14px; border-radius: 16px; border: 1px solid #f0d999; display: flex; gap: 14px; align-items: center; justify-content: space-between; margin-bottom: 16px;
    }
    .hero h1 { font-size: 1.4em; margin: 0; }
    .hero p { margin: 0; font-size: 0.98em; }
    .hero .cta { display: flex; gap: 8px; }
    .hero .cta a {
      background: #fff; border-radius: 10px; padding: 7px 10px; color: #8b5a00; border: 1px solid #f3e1a3; text-decoration: none; font-weight: 600;
    }
    .hero .cta a:hover { background: #fff9e5; color: #5f4200; }
    .banner-alert {
      background: #fff; border: 1px dashed #f0cd7c; border-radius: 12px; padding: 8px 12px; display: flex; align-items: center; gap: 10px; color: #6b4d00; margin-bottom: 20px;
    }
    .banner-alert strong { color: #4d3b00; }
    .shop-layout { display: grid; grid-template-columns: 220px 1fr; gap: 18px; }
    .filter-panel { background: #ffffff; border: 1px solid #f3e5b2; border-radius: 16px; padding: 10px; }
    .filter-panel h3 { font-size: 1.1em; margin: 0 0 8px 0; color: #191813; }
    .filter-group { margin-bottom: 10px; }
    .filter-group label { font-size: 14px; color: #5b4a12; margin-bottom: 6px; display: block; }
    .filter-group input, .filter-group select, .filter-group button {
      width: 100%; padding: 9px 10px; border-radius: 10px; border: 1px solid #eee1b9; background: #fff; color: #2b2100;
    }
    .filter-group button:hover { background: #fff7e0; }
    .products-panel { background: #ffffff; border: 1px solid #f3e5b2; border-radius: 16px; padding: 10px; min-height: 320px; }
    .products-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 8px; }
    .products-header h2 { font-size: 1.17em; margin: 7px 0 4px 0; color: #191813; font-weight: bold; }
    .products-header .actions { display: flex; gap: 8px; align-items: center; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .product-card { background: #fff; border-radius: 16px; box-shadow: 0 3px 14px #f7b73322; border: 1px solid #f0d999; padding: 12px; display: flex; gap: 10px; align-items: center; transition: transform .12s ease, box-shadow .12s ease; }
    .product-card:hover { transform: translateY(-2px) scale(1.03); box-shadow: 0 6px 22px #f7b73333; }
    .product-card img, .product-img-placeholder {
      width: 80px; height: 80px; max-width: 80px; max-height: 80px; border-radius: 12px; object-fit: contain; background: #fff; border: 1px solid #f3e5b2;
    }
    .product-img-placeholder { display: inline-flex; align-items: center; justify-content: center; font-weight: bold; color: #8b5a00; }
    .product-info { min-height: 102px; display: flex; flex-direction: column; gap: 5px; justify-content: center; align-items: center; flex: 1; }
    .product-info .price {
      background: #fffdf0; border: 1px solid #f0d999; border-radius: 10px; padding: 3px 7px; color: #1f1600; font-weight: 700; display: inline-flex; align-items: center; gap: 6px;
    }
    .product-info .price small { color: #866200; font-weight: 600; }
    .product-actions { display: flex; gap: 8px; align-items: center; justify-content: center; width: 100%; }
    .product-actions input {
      width: 82px; padding: 9px 10px; border-radius: 10px; border: 1px solid #eee1b9; background: #fff; color: #2b2100; font-weight: 600;
    }
    .product-actions button {
      background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%); color: #774f00; border: 1px solid #f0d999; border-radius: 10px; padding: 9px 12px; font-weight: 700;
    }
    .product-actions a {
      background: #ffffff; color: #8b5a00; border: 1px solid #f3e1a3; border-radius: 10px; padding: 8px 12px; font-weight: 700; text-decoration: none;
    }
    .product-actions a:hover { background: #fff7e0; color: #5f4200; }
    .product-card h3 { font-size: 1.17em; margin: 7px 0 4px 0; color: #191813; font-weight: bold; text-align: center; width: 100%; letter-spacing: 0.05em; }
    .product-card p { font-size: 14px; margin: 3px 0 0 0; color: #444; text-align: center; width: 100%; }
    .product-card input { width: 100%; padding: 10px; margin: 15px 0; border-radius: 7px; border: 1px solid #eee1b9; font-size: 15px; }
    .product-card .loan-btn, .product-card button { background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%); color: #774f00; border: 1px solid #f0d999; border-radius: 10px; padding: 9px 12px; font-weight: 700; margin-bottom: 0; display: inline-block; align-self: center; min-width: 0; }
    .product-card .loan-btn:hover, .product-card button:hover { background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%); color: #b37900 !important; }
    @media (max-width: 600px) {
      .container { padding: 0.5em; }
      .product-card img, .product-img-placeholder { height: 48px !important; max-height: 48px !important; }
      .product-info { min-height: 50px !important; margin-bottom: 0 !important; padding-bottom: 0 !important; }
      .grid { grid-template-columns: 1fr; gap: 16px 0; }
    }
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 36px 20px; }
    @media (max-width: 1000px) { .grid { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<header>
  <div class="container nav-inner">
    <div class="nav-left">
      <a href="index.html" aria-label="WattSun home">
        <img alt="WattSun logo" src="logo-wattsun.png"/>
      </a>
    </div>
    <nav>
      <button class="nav-toggle" aria-label="Toggle menu">‚ò∞ Menu</button>
      <div class="nav-main">
        <a href="index.html">Home</a>
        <a href="projects.html">Projects</a>
        <a href="solutions.html">Solutions</a>
        <a href="shop.html" aria-current="page">Shop</a>
        <a href="track.html">Track Order</a>
        <a href="contact.html">Contact</a>
      </div>
      <div class="nav-right">
        <a href="myaccount/index.html" aria-label="My Account">My Account</a>
        <a href="cart.html" class="cart-badge" aria-label="Cart">Cart <span class="count">0</span></a>
      </div>
    </nav>
  </div>
</header>

<main class="container" style="flex:1;">
  <div class="hero">
    <div>
      <h1>Shop Solar Kits & Components</h1>
      <p>All prices include VAT. Delivery available nationwide. Financing options available at checkout.</p>
    </div>
    <div class="cta">
      <a href="calculator.html">Financing Calculator</a>
      <a href="contact.html">Talk to an Expert</a>
    </div>
  </div>

  <div class="banner-alert">
    <span>‚ö°</span>
    <div>Tip: Add items to your cart and proceed to checkout to see your deposit and monthly plan.</div>
  </div>

  <div class="shop-layout">
    <aside class="filter-panel">
      <h3>Filters</h3>
      <div class="filter-group">
        <label for="filter-text">Search</label>
        <input id="filter-text" placeholder="Name or SKU">
      </div>
      <div class="filter-group">
        <label for="filter-category">Category</label>
        <select id="filter-category">
          <option value="">All</option>
        </select>
      </div>
      <div class="filter-group">
        <button id="filter-apply">Apply</button>
      </div>
    </aside>

    <section class="products-panel">
      <div class="products-header">
        <h2>Products</h2>
        <div class="actions">
          <a href="cart.html">View Cart</a>
        </div>
      </div>
      <div id="shop-products" class="grid">
        <!-- JS renders cards here -->
      </div>
    </section>
  </div>
</main>

<footer class="mobile-nav">
<a aria-label="Home" href="index.html">üè†</a>
<a aria-label="Account" href="account.html">üë§</a>
<a aria-label="Cart" href="cart.html">üõí<span id="cart-count" style="background:#19c37d; color:white;">0</span></a>
<a aria-label="Menu" href="javascript:void(0);" onclick="document.querySelector('.nav-toggle').click();">‚ò∞</a>
</footer>
<script>
  function parsePrice(raw) {
    return parseInt((raw || '').replace(/[^\d]/g, '')) || 0;
  }

  async function loadProducts() {
    const box = document.getElementById("shop-products");
    try {
      const res = await fetch("/api/items?active=1");
      const data = await res.json();
      const items = Array.isArray(data) ? data : (data.items || []);
      box.innerHTML = "";
      const sorted = items; // rely on API order (priority DESC, name ASC)

      sorted.forEach((prod, idx) => {
        const img = prod.image ? "/images/products/" + prod.image : "/images/placeholder.jpg";
        const price = parsePrice(prod.price);
        const id = "dep_" + idx;
        const card = document.createElement("div");
        card.className = "product-card";
        const safeDesc = (prod.description || "").replace(/'/g, "");
        card.innerHTML = `
          <img src="${img}" alt="${(prod.name || 'Product').replace(/"/g,'&quot;')}" onerror="this.onerror=null;this.src='/images/placeholder.jpg';" />
          <div class="product-info">
            <h3>${prod.name || ""}</h3>
            <p>${safeDesc}</p>
            <div class="price">KSH ${price.toLocaleString('en-KE')} <small>incl. VAT</small></div>
          </div>
          <div class="product-actions">
            <input id="${id}" type="number" min="1" value="1"/>
            <button data-sku="${prod.sku}" data-name="${(prod.name || '').replace(/"/g,'&quot;')}" data-price="${price}" data-input="${id}">Add to Cart</button>
            <a href="product.html?sku=${encodeURIComponent(prod.sku)}">Details</a>
          </div>
        `;
        box.appendChild(card);
      });
    } catch (e) {
      console.error("Failed to load products:", e);
      box.innerHTML = "<p style='color:red;'>Failed to load products.</p>";
    }
  }

  function addToCart(e) {
    const btn = e.target.closest('button[data-sku]');
    if (!btn) return;
    const sku = btn.dataset.sku;
    const name = btn.dataset.name;
    const price = parseInt(btn.dataset.price, 10) || 0;
    const qtyInput = document.getElementById(btn.dataset.input);
    const qty = Math.max(1, parseInt(qtyInput.value, 10) || 1);

    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const existing = cart.find(i => i.sku === sku);
    if (existing) existing.qty += qty; else cart.push({ sku, name, price, qty });
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCountBadge();
  }

  function updateCartCountBadge() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const count = cart.reduce((n,i)=>n+(i.qty||0), 0);
    const badge = document.querySelector('.cart-badge .count');
    if (badge) badge.textContent = count, badge.style.display = count > 0 ? 'flex' : 'none';
    const mobileCount = document.getElementById('cart-count');
    if (mobileCount) mobileCount.textContent = count;
  }

  document.addEventListener('DOMContentLoaded', loadProducts);
  document.addEventListener('click', addToCart);
  document.addEventListener('DOMContentLoaded', updateCartCountBadge);
  window.addEventListener('storage', updateCartCountBadge);

  document.querySelector('.nav-toggle').addEventListener('click', () => {
    document.querySelector('header').classList.toggle('nav-open');
  });
  document.querySelectorAll('header nav a').forEach(link => {
    link.addEventListener('click', () => document.querySelector('header').classList.remove('nav-open'));
  });
</script>
</body>
</html>
